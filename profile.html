<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - My Desire Salon</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.cdnfonts.com/css/backsteal" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Backsteal', sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
        }

        .profile-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 0, 0, 0.2);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .glow-button {
            background: linear-gradient(135deg, #ff0000, #cc0000);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            transition: all 0.3s ease;
        }

        .glow-button:hover {
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.8);
            transform: translateY(-2px);
        }
        
        .error-message {
            color: #ff0000;
            background-color: rgba(255, 0, 0, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
        
        .success-message {
            color: #00aa00;
            background-color: rgba(0, 170, 0, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
    </style>
</head>
<body class="text-white min-h-screen">
    <!-- Header with Logo -->
    <div class="fixed top-0 left-0 p-8 z-50">
        <div>
            <img src="images/lg.png" alt="My Desire Salon" class="h-16 brightness-0 invert cursor-pointer" onclick="window.location.href='index.html'">
        </div>
    </div>
    <div class="sidebar">
        <a href="index.html" class="sidebar-item"><i class="fas fa-home"></i></a>
        <a href="chat.html" class="sidebar-item" id="chatToggle"><i class="fas fa-comments"></i></a>
        <a href="gallery.html" class="sidebar-item"><i class="fas fa-images"></i></a>
        <a href="contact.html" class="sidebar-item"><i class="fas fa-phone-volume"></i></a>
        <a href="profile.html" class="sidebar-item active"><i class="fas fa-user"></i></a>
        <a href="settings.html" class="sidebar-item"><i class="fas fa-cog"></i></a>
        <div class="sidebar-item"><i class="fas fa-shop"></i></div>
    </div>
    <!-- Main Profile Content -->
    <div class="pt-32 pb-20 px-4">
        <div class="max-w-6xl mx-auto">
            <!-- Page Title -->
            <div class="text-center mb-12">
                <h1 class="text-5xl md:text-6xl font-bold mb-4">
                    <span class="text-primary">YOUR</span><br>
                    <span class="text-white">PROFILE</span>
                </h1>
                <p class="text-xl text-gray-300">Manage your personal information</p>
            </div>

            <!-- Profile Form -->
            <div class="profile-card p-6">
                <h2 class="text-2xl font-bold mb-6 text-primary">Personal Details</h2>
                <div id="errorMessage" class="error-message"></div>
                <div id="successMessage" class="success-message"></div>
                <form id="profileForm">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">Full Name</label>
                            <input type="text" id="profileName" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Phone Number</label>
                            <input type="tel" id="profilePhone" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Email</label>
                            <input type="email" id="profileEmail" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none" required>
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <button type="submit" id="saveProfileBtn" class="glow-button px-12 py-4 text-xl font-bold rounded-lg text-white">
                            <i class="fas fa-save mr-2"></i>Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer style="text-align: center; justify-content: center;">&copy; Copyright (c) 2025 Petley Inc. All rights reserved.<br>Unauthorized copying, modification, or distribution of this software is prohibited.</footer>

    <script>
        // API base URL
        const API_BASE_URL = 'http://localhost:8000';

        // Load user profile on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const userId = localStorage.getItem('userId');
            if (!userId) {
                // Redirect to login if not logged in
                window.location.href = 'login.html';
                return;
            }
            
            loadProfile();
            setupEventListeners();
        });

        // Function to load user profile
        async function loadProfile() {
            const userId = localStorage.getItem('userId');
            
            if (!userId) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/users/${userId}`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                    const userData = await response.json();
                    document.getElementById('profileName').value = userData.name || '';
                    document.getElementById('profilePhone').value = userData.phone || '';
                    document.getElementById('profileEmail').value = userData.email || '';
                } else {
                    const errorData = await response.json();
                    showError('Failed to load profile: ' + (errorData.detail || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error loading profile:', error);
                showError('An error occurred while loading your profile.');
            }
        }

        // Function to save profile changes
        async function saveProfile(event) {
            event.preventDefault(); // Prevent form submission
            
            const userId = localStorage.getItem('userId');
            const name = document.getElementById('profileName').value;
            const phone = document.getElementById('profilePhone').value;
            const email = document.getElementById('profileEmail').value;
            
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            
            // Hide messages
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';

            if (!name || !phone || !email) {
                showError('Please fill in all fields');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/users/${userId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, phone })
                });

                if (response.ok) {
                    const result = await response.json();
                    showSuccess('Profile updated successfully!');
                    // Optionally reload profile to reflect changes
                    loadProfile();
                } else {
                    const errorData = await response.json();
                    showError('Failed to update profile: ' + (errorData.detail || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving profile:', error);
                showError('An error occurred while saving your profile.');
            }
        }
        
        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            
            // Hide success message if visible
            const successMessage = document.getElementById('successMessage');
            successMessage.style.display = 'none';
        }
        
        function showSuccess(message) {
            const successMessage = document.getElementById('successMessage');
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            
            // Hide error message if visible
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.style.display = 'none';
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('saveProfileBtn').addEventListener('click', saveProfile);
        }
    </script>
</body>
</html>